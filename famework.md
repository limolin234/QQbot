# QQbot

## 项目介绍

这是一个基于python的聊天机器人，其核心功能为自动接龙和群消息总结，目前使用napcat作为信息收发方式开发。

## 项目架构

本项目采用多种方式对消息进行过滤以便于ai处理。

1. 基于消息号码进行初步过滤
2. 基于正则与消息号码进行分类
3. 维护一个任务优先队列对将消息分类 有序的投入ai
4. 维护多个ai对话线程，从任务队列中依次获取任务

## 架构说明

1. 基于消息号码和正则(暂时是关键词，够用了)的分类 将任务分为RT类型和IDLE类型 其中RT类型分为回复型和转发型 IDLE用于定期总结
2. 实现支持RT类型和IDLE类型的消息队列 学习Linux的部分任务调度机制实现调度器
3. 针对RT类任务和IDLE任务进行不同ai处理。

### ai任务处理

1. 针对RT型任务，直接交由AI处理，AI提示词要说明AI要使用特定格式内容回复，然后使用正则等方式提取出AI回复中的内容和发送对象，进行消息发送。
2. 针对IDLE型总结任务，每次调用都将内容写入日志，定期从日志中获取适当长度的内容然后直接发送ai返回的内容。

## 安全问题

1. 机器人有在多个重要的大群回复的权限，严防恶意攻击，napcat部署的时候最好配置外部无法访问的端口
2. 放置ai乱发消息，群中发送的消息应当加上消息长度和发送频率限制，触发后暂停服务并发送警报

