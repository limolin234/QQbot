# Dida365 任务管理集成指南

本机器人集成了 Dida365（滴答清单）API，支持通过 QQ 群聊或私聊直接管理任务。每个用户都可以绑定自己的 Dida365 账号，实现个人任务的独立管理。

## 1. 首次配置（开发者/管理员）

在机器人运行前，需要配置 Dida365 的 OAuth 应用信息。

### 步骤
1.  登录 [Dida365 开发者中心](https://dida365.com/developer/)（或 TickTick 开发者中心）。
2.  创建一个新应用 (App)。
    *   **App Name**: QQBot (或自定义)
    *   **OAuth Redirect URL**: 填写一个可用的 URL（例如 `http://localhost:8080/callback`），或者如果只是为了获取 Code，可以填任意 URL（但需记住）。
3.  获取 `Client ID` 和 `Client Secret`。
4.  打开 `QQbot/workflows/agent_config.yaml` 文件，找到 `dida_config` 部分并填写：

```yaml
dida_config:
  client_id: "你的Client_ID"
  client_secret: "你的Client_Secret"
  redirect_uri: "你在Dida后台填写的Redirect_URL"
  # 其他配置保持默认即可
  project_ids: [] # 留空，机器人会自动获取项目列表
```

## 2. 用户绑定流程（所有用户）

任何想要使用任务管理功能的用户（包括管理员和普通群员），都需要先进行账号绑定。

### 未绑定的表现
如果用户未绑定账号，发送任务相关指令（如“创建任务”、“查看任务”）时，机器人会回复：
> ⚠️ 尚未绑定 Dida 账号，请先发送 /dida_auth 获取授权链接。

### 绑定步骤
1.  **获取授权链接**：
    用户发送指令：
    ```
    /dida_auth
    ```
    机器人回复一个授权链接。

2.  **进行授权**：
    用户点击链接，在浏览器中登录 Dida365 账号并点击“同意授权”。

3.  **获取 Code**：
    授权成功后，浏览器会跳转到 `redirect_uri`。**请复制跳转后 URL 地址栏中 `code=` 后面的字符串**。
    *   例如跳转地址是 `http://localhost:8080/callback?code=p0c8...&state=...`
    *   则 Code 为 `p0c8...`

4.  **完成绑定**：
    用户发送指令：
    ```
    /bind_dida code=刚才复制的Code
    ```
    机器人回复：
    > ✅ Dida 绑定成功，可以开始创建任务。

## 3. 使用指南

绑定成功后，即可使用自然语言管理任务。

### 常用指令示例
*   **创建任务**：
    *   “提醒我明天下午3点开会”
    *   “添加一个任务：买牛奶”
*   **查询任务**：
    *   “查看我的任务”
    *   “我今天有什么安排？”
*   **完成任务**：
    *   “完成买牛奶的任务”
    *   “把开会那个任务勾掉”
*   **删除任务**：
    *   “删除买牛奶的任务”

### 多用户支持
*   每个用户的授权信息是**独立存储**的。
*   在同一个群里，用户 A 只能操作用户 A 的清单，用户 B 只能操作用户 B 的清单。
*   机器人会根据发送指令的 QQ 号自动识别身份。

## 4. 常见问题

**Q: 绑定过期了怎么办？**
A: Dida365 的授权 Token 可能会过期。如果机器人提示授权无效，请重新执行 `/dida_auth` 和 `/bind_dida` 流程。

**Q: 机器人能看到我的所有任务吗？**
A: 机器人可以访问你授权范围内的所有任务，但 AI 智能回复时，只会读取你的“未完成”任务作为上下文，且仅限你本人可见。

**Q: 为什么删除任务失败？**
A: 请确保你描述的任务标题准确，或者先让机器人“查看任务”获取任务 ID，然后尝试更精确的描述。
