# 本文件说明了当前存在的问题和改进方针

## 现有问题

### 配置文件混乱

配置文件的混乱很大程度也是因为判断逻辑欠整合
bot.py中的配置供scheduler中的预处理逻辑和handler中的回复使用
agent又使用专门的配置

### 判定逻辑混乱

理论上agent只用于ai判断,而本地逻辑判断应当作为预处理部分在入队前完成
现有的任务队列正是为此设计.一旦处理时间长短有极大差异的本地与agent任务混合投入,队列将可能面对一系列设计之外的调用场景,这可能严重影响性能(如:一个耗时长的agent任务卡住大量耗时短的本地判断任务,导致任务队列的容量被浪费)

## 解决方针

由处理机制重构带动配置文件重构

### 处理机制重构

发展至此,本地预处理的复杂程度已经超出我一开始的预期,现在需要对scheduler进行拆分,分成纯粹的任务队列定义和实例新的scheduler.py和preprocessor.py 所有的预处理任务都会由preprocessor.py完成 processmsg等函数也将移入preprocessor.py

为了统一配置文件并将本地识别放入预处理任务,现有的agent也将被拆分,其中的所有本地判断都会被拆分放入preprocessor.py中然后保留agent调用的部分在原文件中.新的配置文件将被preprocessor和agent共用
为了将预处理和agent调用解耦,task类可能需要重构用来容纳指定任务所用的更多信息,最终理想中的处理机制如下.
